### 9.3 Code evaluation in action

在9.1中我们看到代码解析可以多种方式生效，下面我们就通过例子来看看在何时何地该使用这种功能。

#### 9.3.1 Converting JSON

Json是Javascript语言的子集，所以js把Json解析为代码是非常简单的。代码动态解析的常用场景可能就是把字符串形式的Json数据转成对应的Javascript对象。

大部分浏览器的都有JSON对象，有parse()和stringify()方法来处理Json字符串。但是很多原始浏览器并没有这个对象。对于这部分浏览器，如何在没有`window.JSON`对象时处理json字符串就非常重要了。

其实处理方法非常简单，就是通过eval解析json字符串，只是我们要记得给json字符串加上括号。如下所示：

```javascript
<script type="text/javascript">

  var json = '{"name":"Ninja"}';               //#1

  var object = eval("(" + json + ")");         //#2

  assert(object.name === "Ninja",              //#3
         "My name is Ninja!");                 //#3

</script>
```
非常简单，而且在多数js引擎上都支持。

当然如上一章所说，盲目的执行不可信服务器的代码是有风险的，切记。

最流行的JSON转换器脚本是`Douglas Crockford`写的，他是Json的创建者。其中他对json字符串做了一些预处理防止非法操作。代码详见[github](https://github.com/douglascrockford/JSON-js)

其中主要的预处理包括：

* 防止一些可能导致浏览器出问题的unicode字符的出现
* 防止非Json模式的出现，比如赋值操作，`new`操作符等
* 确保只有合法的json字符才能出现

所以，如果需要处理来自非可信站的json字符串，最好使用`Douglas`的转换器。对于处理非可信代码的更多更深入的讨论见下面：

* Single Page Web Applications by Michael S. Mikowski and Josh C. Powell (http:// www.manning.com/mikowski/)
* Third-Party JavaScript by Ben Vinegar and Anton Kovalyov (http://manning .com/vinegar/)

好了，下面我们来看另外一个例子。
